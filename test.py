import streamlit as st

# ===============================
# 앱 기본 설정
# ===============================
st.set_page_config(page_title="🐶 강아지 행동 설명 앱", page_icon="🐾", layout="wide")
st.title("🐶 강아지 행동 설명 앱")
st.write("강아지가 어떤 행동을 하는지 선택하면 의미와 대처법을 알려드려요! 기록된 행동을 바탕으로 맞춤 피드백도 제공합니다 📝")

# ===============================
# 강아지 기본 정보 입력
# ===============================
st.sidebar.header("📋 강아지 정보 입력")

dog_name = st.sidebar.text_input("🐕 이름", value="우리 강아지")
dog_age = st.sidebar.number_input("🎂 나이(살)", min_value=0, max_value=30, value=2)
dog_breed = st.sidebar.text_input("🐾 견종", value="믹스견")
dog_gender = st.sidebar.radio("⚧ 성별", ["수컷", "암컷", "모름"])

st.sidebar.markdown("---")
st.sidebar.write(f"**입력된 정보 요약**")
st.sidebar.write(f"🐶 이름: {dog_name}")
st.sidebar.write(f"🎂 나이: {dog_age}살")
st.sidebar.write(f"🐾 견종: {dog_breed}")
st.sidebar.write(f"⚧ 성별: {dog_gender}")

# ===============================
# 행동 데이터 (카테고리별 + 이모지 포함)
# ===============================
dog_behaviors = {
    "꼬리": {
        "🐕‍🦺 꼬리를 크게 흔듦": {"의미": "😍 기쁨과 반가움의 신호예요.", "대처법": "같이 놀아주고 교감을 해주세요 🐾", "긍정": True},
        "🐕 꼬리를 천천히 흔듦": {"의미": "🤔 경계하거나 주의를 기울이는 상태예요.", "대처법": "안심할 수 있게 도와주세요.", "긍정": False},
        "😟 꼬리를 다리 사이에 넣음": {"의미": "😨 불안, 두려움, 복종을 의미해요.", "대처법": "달래주고 환경을 안정시켜 주세요.", "긍정": False},
        "😠 꼬리를 뻣뻣하게 세움": {"의미": "⚠️ 긴장, 위협 신호예요.", "대처법": "자극적인 상황을 피하세요.", "긍정": False},
    },
    "귀": {
        "👂 귀를 앞으로 세움": {"의미": "👀 호기심, 관심, 경계심이에요.", "대처법": "탐색을 도와주거나 진정시켜 주세요.", "긍정": True},
        "👂 귀를 뒤로 젖힘": {"의미": "😔 불안, 두려움, 복종의 신호예요.", "대처법": "진정시키고 배려하세요.", "긍정": False},
        "👂 귀를 한쪽만 움직임": {"의미": "🤨 한쪽 소리에 집중하거나 혼란스러워해요.", "대처법": "환경을 확인하세요.", "긍정": False},
    },
    "몸짓": {
        "🙃 배를 보여줌": {"의미": "💖 복종과 신뢰의 표현이에요.", "대처법": "부드럽게 쓰다듬어 주세요.", "긍정": True},
        "🤣 바닥에 뒹굴기": {"의미": "😆 놀이 요청, 기쁨이에요.", "대처법": "같이 놀아주세요.", "긍정": True},
        "🥶 몸을 떨음": {"의미": "😥 스트레스 해소, 불안, 흥분 상태일 수 있어요.", "대처법": "휴식을 주세요.", "긍정": False},
        "😡 등을 구부리고 으르렁거림": {"의미": "🚨 공격적이거나 방어 신호예요.", "대처법": "접근하지 말고 시간을 주세요.", "긍정": False},
        "👋 앞발로 툭툭 치기": {"의미": "😋 관심을 원하거나 놀고 싶어요.", "대처법": "가능하면 반응해 주세요.", "긍정": True},
    },
    "소리": {
        "🐶 크게 짖음": {"의미": "🔔 경계, 흥분, 주목을 끌려는 행동이에요.", "대처법": "원인을 파악하세요.", "긍정": False},
        "🥺 낑낑거림": {"의미": "😢 불안, 주목 욕구, 또는 통증일 수 있어요.", "대처법": "상황을 살피고 필요시 병원 방문하세요.", "긍정": False},
        "😤 낮게 으르렁거림": {"의미": "⚠️ 위협을 느끼거나 경고 신호예요.", "대처법": "자극하지 말고 공간을 주세요.", "긍정": False},
        "🌙 하울링": {"의미": "😔 외로움, 스트레스, 다른 개 반응이에요.", "대처법": "교감을 늘려주세요.", "긍정": False},
    },
    "표정": {
        "🥱 하품함": {"의미": "😴 졸림, 지루함, 스트레스 해소예요.", "대처법": "편안하게 해주세요.", "긍정": False},
        "👅 혀를 낼름거림": {"의미": "😖 긴장, 불안, 달래는 신호예요.", "대처법": "자극을 줄여주세요.", "긍정": False},
        "🙈 눈을 피함": {"의미": "😓 불안, 두려움, 복종 신호예요.", "대처법": "시간을 주세요.", "긍정": False},
        "😳 눈을 크게 뜸": {"의미": "😲 경계심, 놀람, 두려움이에요.", "대처법": "안심시켜 주세요.", "긍정": False},
    },
    "습관": {
        "🦶 발을 핥음": {"의미": "🤒 불안, 지루함, 피부 문제일 수 있어요.", "대처법": "과도하면 수의사 상담하세요.", "긍정": False},
        "🪵 바닥을 긁음": {"의미": "😅 둥지 만들기, 지루함이에요.", "대처법": "놀이와 산책을 늘리세요.", "긍정": False},
        "🔄 돌아다니며 빙빙 돎": {"의미": "😬 흥분, 불안, 습관적 행동이에요.", "대처법": "진정시켜 주세요.", "긍정": False},
        "🧸 장난감을 물고 옴": {"의미": "😆 놀고 싶다는 표현이에요.", "대처법": "같이 놀아주세요.", "긍정": True},
        "👃 바닥을 냄새 맡음": {"의미": "🧐 탐색, 불안, 본능이에요.", "대처법": "과하지 않으면 괜찮아요.", "긍정": True},
    },
    "식사": {
        "🍽️ 사료를 안 먹음": {"의미": "🤢 스트레스, 건강 문제, 입맛 변화일 수 있어요.", "대처법": "지속되면 병원에 가세요.", "긍정": False},
        "⚡ 급하게 먹음": {"의미": "😮‍💨 경쟁심, 불안, 습관이에요.", "대처법": "슬로우 피더 그릇을 쓰세요.", "긍정": False},
        "🤮 먹은 후 토함": {"의미": "🤔 소화 문제, 과식, 건강 이상일 수 있어요.", "대처법": "지속되면 병원에 가세요.", "긍정": False},
    },
    "사회성": {
        "🐕 다른 개 위에 올라탐": {"의미": "😅 지배욕, 놀이, 흥분 상태예요.", "대처법": "상대가 불편해하면 제지하세요.", "긍정": False},
        "🐩 다른 개 주위를 맴돎": {"의미": "👋 호기심, 사회적 인사예요.", "대처법": "자연스러운 행동이에요.", "긍정": True},
        "😘 주인의 얼굴을 핥음": {"의미": "💞 애정 표현, 복종, 인사예요.", "대처법": "받아주되 원치 않으면 제지하세요.", "긍정": True},
    }
}

# ===============================
# 카테고리 선택 + 행동 선택
# ===============================
category = st.radio("📂 카테고리를 선택하세요:", list(dog_behaviors.keys()))
behavior = st.selectbox("🐾 행동을 선택하세요:", list(dog_behaviors[category].keys()))

# ===============================
# 선택 결과 출력
# ===============================
if behavior:
    info = dog_behaviors[category][behavior]
    st.subheader(f"{behavior}")
    st.write(f"**의미:** {info['의미']}")
    st.write(f"**대처법:** {info['대처법']}")

    # 행동 기록
    if "history" not in st.session_state:
        st.session_state.history = []

    if st.button("📌 이 행동 기록하기"):
        st.session_state.history.append({"행동": behavior, **info})

# ===============================
# 기록된 행동 요약 + 스트레스 지수 + 피드백
# ===============================
if "history" in st.session_state and st.session_state.history:
    st.markdown("---")
    st.subheader(f"📊 {dog_name}의 오늘 기록된 행동")

    positive = sum(1 for h in st.session_state.history if h["긍정"])
    negative = len(st.session_state.history) - positive

    for idx, h in enumerate(st.session_state.history, 1):
        st.write(f"{idx}. {h['행동']} → {h['의미']}")

    st.write(f"✅ 긍정 행동 수: {positive}")
    st.write(f"⚠️ 부정/스트레스 행동 수: {negative}")

    # 스트레스 지수 결과
    if negative > positive:
        st.error(f"😟 {dog_name}의 스트레스 지수가 높아요. 강아지를 안정시켜 주세요!")
    else:
        st.success(f"🥰 {dog_name}가 행복한 하루를 보내고 있어요!")

    # ===============================
    # 맞춤 피드백 기능
    # ===============================
    st.markdown("### 📝 맞춤 피드백")

    feedback = []
    if negative >= 3:
        feedback.append("⚠️ 스트레스 신호가 많아요. 산책이나 놀이 시간을 늘려주세요.")
    if any("낑낑거림" in h["행동"] for h in st.session_state.history):
        feedback.append("🩺 낑낑거림이 잦으면 불안 또는 통증일 수 있어요. 관찰이 필요합니다.")
    if any("토함" in h["행동"] for h in st.session_state.history):
        feedback.append("🚑 먹은 후 토하는 행동이 반복되면 반드시 수의사 상담이 필요합니다.")
    if positive >= 3 and negative == 0:
        feedback.append("🎉 아주 행복한 하루를 보내고 있어요! 지금처럼만 돌봐주세요.")
    if not feedback:
        feedback.append("🙂 특별한 문제는 없지만 꾸준한 교감과 돌봄이 필요해요.")

    for fb in feedback:
        st.write(fb)
